name = "williw"
type = "rust"
account_id = "yuanjieliu"
workers_dev = true
route = ""
zone_id = ""

[build]
command = "cargo build --target wasm32-unknown-unknown --release --features workers"
upload = { format = "wasm" }

[build.upload]
dir = "wasm/pkg"
main = "./williw_wasm.js"

[vars]
NODE_ENV = "production"
LOG_LEVEL = "info"
MAX_NODES = "1000"
ZK_PROOF_ENABLED = "true"

[kv_namespaces]
{ binding = "NODES_STORE", id = "nodes-store-id" }
{ binding = "TASKS_STORE", id = "tasks-store-id" }
{ binding = "PROOFS_STORE", id = "proofs-store-id" }

[durable_objects]
{ name = "NodeRegistry", class_name = "NodeRegistry" }
{ name = "TaskScheduler", class_name = "TaskScheduler" }
{ name = "ProofVerifier", class_name = "ProofVerifier" }

[[rules]]
type = "Worker"
pattern = "api/*"
script = "williw-edge-server"

[[rules]]
type = "Worker"
pattern = "ws/*"
script = "williw-edge-server"

[triggers]
crons = ["*/5 * * * *"]  # 每5分钟执行一次维护任务
